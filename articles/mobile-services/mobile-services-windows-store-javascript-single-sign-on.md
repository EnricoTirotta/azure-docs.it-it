<properties 
	pageTitle="Autenticare l'app con Live Connect (JavaScript)" 
	description="Informazioni su come usare l'accesso Single Sign-On di Live Connect in Servizi mobili di Azure da un'applicazione di Windows Store." 
	services="mobile-services" 
	documentationCenter="windows" 
	authors="ggailey777" 
	manager="dwrede" 
	editor=""/>

<tags 
	ms.service="mobile-services" 
	ms.workload="mobile" 
	ms.tgt_pltfrm="mobile-windows-store" 
	ms.devlang="javascript" 
	ms.topic="article" 
	ms.date="04/08/2015" 
	ms.author="glenga"/>

# Autenticare l'app di Windows Store mediante l'autenticazione gestita da client con account Microsoft

[AZURE.INCLUDE [mobile-services-selector-single-signon](../../includes/mobile-services-selector-single-signon.md)] 

##Panoramica
In questo argomento viene illustrato come autenticare gli utenti in Servizi mobili di Azure da un'app di Windows Store. Nell'esercitazione verrà aggiunta l'autenticazione al progetto di guida introduttiva tramite Live Connect. Dopo essere stato autenticato da Live Connect e avere eseguito l'accesso, l'utente visualizza una schermata di benvenuto in cui sono indicati il nome utente e il relativo ID.

>[AZURE.NOTE]Questa esercitazione illustra i vantaggi offerti dall'uso dell'autenticazione gestita da client e di Live SDK. Ciò consente di semplificare l'autenticazione degli utenti che hanno già effettuato l'accesso al servizio mobile. È inoltre possibile richiedere ambiti aggiuntivi per consentire all'app di accedere anche a risorse come OneDrive. L'autenticazione gestita dal servizio offre un'esperienza più generalizzata e supporta più provider di autenticazione. Per altre informazioni sull'autenticazione gestita dal servizio, vedere l'argomento [Aggiungere l'autenticazione all'app](mobile-services-windows-store-javascript-get-started-users.md).

Per completare questa esercitazione, è necessario disporre di:

+ [Live SDK per Windows]
+ Microsoft Visual Studio 2012 Express per Windows 8 RC o versione successiva
+ È inoltre necessario completare l'esercitazione [Aggiungere Servizi mobili a un'app esistente].

##Registrare l'app per l'uso dell'account Microsoft per l'autenticazione

Per poter autenticare gli utenti, è necessario registrare l'app presso il centro per sviluppatori degli account Microsoft. È quindi necessario connettere questa registrazione al servizio mobile. Completare i passaggi nell'argomento seguente per creare una registrazione di account Microsoft e connettersi al servizio mobile.

+ [Registrare l'app per l'uso delle credenziali di accesso di un account Microsoft](mobile-services-how-to-register-microsoft-authentication.md)

##<a name="permissions"></a>Limitare le autorizzazioni agli utenti autenticati

È quindi necessario limitare l'accesso a una risorsa, in questo caso la tabella *TodoItems*, per assicurarsi che sia accessibile solo da un utente connesso.

[AZURE.INCLUDE [mobile-services-restrict-permissions-windows](../../includes/mobile-services-restrict-permissions-windows.md)] 

##<a name="add-authentication"></a>Aggiungere l'autenticazione all'app

Infine, aggiungere Live SDK e usarlo per autenticare gli utenti nell'app.

1. In **Esplora soluzioni** fare clic con il pulsante destro del mouse sulla soluzione e quindi scegliere **Gestisci pacchetti NuGet**.

2. Nel riquadro a sinistra selezionare la categoria **Online**, cercare **LiveSDK**, fare clic su **Installa** nel pacchetto di **Live SDK**, selezionare tutti i progetti e quindi accettare i contratti di licenza.

  	Live SDK verrà aggiunto alla soluzione.

3. Aprire il file di progetto default.html e aggiungere l'elemento `<script>` seguente nell'elemento `<head>`.

        <script src="/js/wl.js"></script>

5. Nell'overload del metodo **app.OnActivated** sostituire la chiamata al metodo **refreshTodoItems** con il codice seguente:
	
        // Set the mobileClient variable to client variable generated by the tooling.
        var mobileClient = <yourClient>;

        var session = null;
        var login = function () {
            return new WinJS.Promise(function (complete) {
                WL.login({ scope: "wl.basic" }).then(function (result) {
                    session = result.session;

                    WinJS.Promise.join([
                        WL.api({ path: "me", method: "GET" }),
                        mobileClient.login(result.session.authentication_token)
                    ]).done(function (results) {
                        // Build the welcome message from the Microsoft account info.
                        var profile = results[0];                            
                        var title = "Welcome " + profile.first_name + "!";
                        var message = "You are now logged in as: "
                            + mobileClient.currentUser.userId;
                        var dialog = new Windows.UI.Popups.MessageDialog(message, title);
                        dialog.showAsync().then(function () {
                            // Reload items from the mobile service.
                            refreshTodoItems();
                        }).done(complete);
                        
                    }, function (error) {

                    });
                }, function (error) {
                    session = null;
                    var dialog = new Windows.UI.Popups.MessageDialog("You must log in.", "Login Required");
                    dialog.showAsync().done(complete);
                });
            });
        }

        var authenticate = function () {
            // Block until sign-in is successful.
            login().then(function () {
                if (session === null) {
                    // Authentication failed, try again.
                    authenticate();
                }
            });
        }

		// Initialize the Live client.
        WL.init({
            redirect_uri: mobileClient.applicationUrl
        });

		// Start the sign-in process.
        authenticate();

    Questo codice inizializza il client Live Connect, invia una nuova richiesta di accesso all'account Microsoft, invia il token di autenticazione restituito a Servizi mobili e quindi visualizza informazioni sull'utente connesso.

	>[AZURE.NOTE]È preferibile evitare di richiedere token di autenticazione di Live Connect o Servizi mobili ogni volta che viene eseguita l'app. Oltre a essere inefficace, questo metodo può comportare problemi di utilizzo nel caso in cui molti clienti provino ad avviare simultaneamente l'app. Un metodo migliore è quello di memorizzare i token nella cache e provare a usare il token di Servizi mobili nella cache prima di chiamare **LoginWithMicrosoftAccountAsync**. Per un esempio di come memorizzare nella cache questo token, vedere [Introduzione all'autenticazione](mobile-services-windows-store-javascript-get-started-users.md#tokens).
	
7. Sostituire il valore `<yourClient>` nella prima riga del codice precedente con la variabile definita nel file con estensione js aggiunto quando il progetto è stato connesso al servizio mobile.
		
8. Premere F5 per eseguire l'app e accedere con l'account Microsoft.

   	Dopo l'accesso, l'app dovrebbe funzionare senza errori e dovrebbe essere possibile eseguire query in Servizi mobili e aggiornare i dati.

## <a name="next-steps"> </a>Passaggi successivi

Nella prossima esercitazione, [Autorizzazione di utenti con script], il valore dell'ID utente fornito da Servizi mobili e basato su un utente autenticato verrà utilizzato per filtrare i dati restituiti da Servizi mobili. Per informazioni su come utilizzare altri provider di identità per l'autenticazione, vedere [Introduzione all'autenticazione].

<!-- Anchors. -->
[Register your app for authentication and configure Mobile Services]: #register
[Restrict table permissions to authenticated users]: #permissions
[Add authentication to the app]: #add-authentication
[Next Steps]: #next-steps

<!-- Images. -->

<!-- URLs. -->
[Submit an app page]: http://go.microsoft.com/fwlink/p/?LinkID=266582
[My Applications]: http://go.microsoft.com/fwlink/p/?LinkId=262039
[Live SDK per Windows]: http://go.microsoft.com/fwlink/p/?LinkId=262253
[Aggiungere Servizi mobili a un'app esistente]: mobile-services-windows-store-javascript-get-started-data.md
[Introduzione all'autenticazione]: mobile-services-windows-store-javascript-get-started-users.md
[Autorizzazione di utenti con script]: ../mobile-services-windows-store-javascript-authorize-users-in-scripts.md

[Azure Management Portal]: https://manage.windowsazure.com/

<!---HONumber=58--> 